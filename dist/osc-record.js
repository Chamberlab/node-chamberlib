'use strict';

var memwatch = require('memwatch-next'),
    cl = require('../src/index').default,
    path = require('path'),
    lmdbIn = new cl.nodes.storage.LMDBNode(),
    osc = new cl.nodes.io.OSCNode(52777),
    dataPath = path.resolve('../data/lmdb/osc-record-test');

var inputUuid = void 0,
    DataChannels = {};

memwatch.on('leak', function (info) {
    console.log('WARNING: ' + info.reason + ' - Growth: ' + info.growth);
});

lmdbIn.createDataSet(dataPath, 2.0, 'osc-record-test');

lmdbIn.on('stats', function (stats) {
    if (stats.data.in && stats.data.in.DataEvent >= 1000) {
        osc.disable();
    }
});

lmdbIn.on('done', function () {
    console.log('done!');
    process.exit(0);
});

lmdbIn.on('error', function (err) {
    console.log(err.message);
    process.exit(err.code);
});

osc.on('addchannel', function (channel) {
    lmdbIn.meta.DataSet.DataChannels[channel.uuid] = Object.assign({}, lmdbIn.meta.DataSet.DataChannels['osc-record-test']);
    lmdbIn.meta.DataSet.DataChannels[channel.uuid].title = channel.title;
});

DataChannels['osc-record-test'] = {
    type: {
        class: 'DataEvent',
        type: null,
        length: 0
    },
    keySize: 16,
    keyPrecision: 6,
    keyUnit: null,
    units: [],
    labels: [],
    uuids: []
};

inputUuid = lmdbIn.createInput(DataChannels, false);

osc.enableMessageReceive();
osc.output.pipe(lmdbIn.inputs[inputUuid].stream);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9zYy1yZWNvcmQuanMiXSwibmFtZXMiOlsibWVtd2F0Y2giLCJyZXF1aXJlIiwiY2wiLCJkZWZhdWx0IiwicGF0aCIsImxtZGJJbiIsIm5vZGVzIiwic3RvcmFnZSIsIkxNREJOb2RlIiwib3NjIiwiaW8iLCJPU0NOb2RlIiwiZGF0YVBhdGgiLCJyZXNvbHZlIiwiaW5wdXRVdWlkIiwiRGF0YUNoYW5uZWxzIiwib24iLCJpbmZvIiwiY29uc29sZSIsImxvZyIsInJlYXNvbiIsImdyb3d0aCIsImNyZWF0ZURhdGFTZXQiLCJzdGF0cyIsImRhdGEiLCJpbiIsIkRhdGFFdmVudCIsImRpc2FibGUiLCJwcm9jZXNzIiwiZXhpdCIsImVyciIsIm1lc3NhZ2UiLCJjb2RlIiwiY2hhbm5lbCIsIm1ldGEiLCJEYXRhU2V0IiwidXVpZCIsIk9iamVjdCIsImFzc2lnbiIsInRpdGxlIiwidHlwZSIsImNsYXNzIiwibGVuZ3RoIiwia2V5U2l6ZSIsImtleVByZWNpc2lvbiIsImtleVVuaXQiLCJ1bml0cyIsImxhYmVscyIsInV1aWRzIiwiY3JlYXRlSW5wdXQiLCJlbmFibGVNZXNzYWdlUmVjZWl2ZSIsIm91dHB1dCIsInBpcGUiLCJpbnB1dHMiLCJzdHJlYW0iXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBTUEsV0FBV0MsUUFBUSxlQUFSLENBQWpCO0FBQUEsSUFDSUMsS0FBS0QsUUFBUSxjQUFSLEVBQXdCRSxPQURqQztBQUFBLElBRUlDLE9BQU9ILFFBQVEsTUFBUixDQUZYO0FBQUEsSUFHSUksU0FBUyxJQUFJSCxHQUFHSSxLQUFILENBQVNDLE9BQVQsQ0FBaUJDLFFBQXJCLEVBSGI7QUFBQSxJQUlJQyxNQUFNLElBQUlQLEdBQUdJLEtBQUgsQ0FBU0ksRUFBVCxDQUFZQyxPQUFoQixDQUF3QixLQUF4QixDQUpWO0FBQUEsSUFLSUMsV0FBV1IsS0FBS1MsT0FBTCxDQUFhLDhCQUFiLENBTGY7O0FBT0EsSUFBSUMsa0JBQUo7QUFBQSxJQUFlQyxlQUFlLEVBQTlCOztBQUVBZixTQUFTZ0IsRUFBVCxDQUFZLE1BQVosRUFBb0IsVUFBU0MsSUFBVCxFQUFlO0FBQy9CQyxZQUFRQyxHQUFSLGVBQXdCRixLQUFLRyxNQUE3QixtQkFBaURILEtBQUtJLE1BQXREO0FBQ0gsQ0FGRDs7QUFJQWhCLE9BQU9pQixhQUFQLENBQXFCVixRQUFyQixFQUErQixHQUEvQixFQUFvQyxpQkFBcEM7O0FBRUFQLE9BQU9XLEVBQVAsQ0FBVSxPQUFWLEVBQW1CLFVBQUNPLEtBQUQsRUFBVztBQUMxQixRQUFJQSxNQUFNQyxJQUFOLENBQVdDLEVBQVgsSUFBaUJGLE1BQU1DLElBQU4sQ0FBV0MsRUFBWCxDQUFjQyxTQUFkLElBQTJCLElBQWhELEVBQXNEO0FBQ2xEakIsWUFBSWtCLE9BQUo7QUFDSDtBQUNKLENBSkQ7O0FBTUF0QixPQUFPVyxFQUFQLENBQVUsTUFBVixFQUFrQixZQUFNO0FBQ3BCRSxZQUFRQyxHQUFSLENBQVksT0FBWjtBQUNBUyxZQUFRQyxJQUFSLENBQWEsQ0FBYjtBQUNILENBSEQ7O0FBS0F4QixPQUFPVyxFQUFQLENBQVUsT0FBVixFQUFtQixVQUFDYyxHQUFELEVBQVM7QUFDeEJaLFlBQVFDLEdBQVIsQ0FBWVcsSUFBSUMsT0FBaEI7QUFDQUgsWUFBUUMsSUFBUixDQUFhQyxJQUFJRSxJQUFqQjtBQUNILENBSEQ7O0FBS0F2QixJQUFJTyxFQUFKLENBQU8sWUFBUCxFQUFxQixVQUFDaUIsT0FBRCxFQUFhO0FBQzlCNUIsV0FBTzZCLElBQVAsQ0FBWUMsT0FBWixDQUFvQnBCLFlBQXBCLENBQWlDa0IsUUFBUUcsSUFBekMsSUFDSUMsT0FBT0MsTUFBUCxDQUFjLEVBQWQsRUFBaUJqQyxPQUFPNkIsSUFBUCxDQUFZQyxPQUFaLENBQW9CcEIsWUFBcEIsQ0FBaUMsaUJBQWpDLENBQWpCLENBREo7QUFFQVYsV0FBTzZCLElBQVAsQ0FBWUMsT0FBWixDQUFvQnBCLFlBQXBCLENBQWlDa0IsUUFBUUcsSUFBekMsRUFBK0NHLEtBQS9DLEdBQXVETixRQUFRTSxLQUEvRDtBQUNILENBSkQ7O0FBTUF4QixhQUFhLGlCQUFiLElBQWtDO0FBQzlCeUIsVUFBTTtBQUNGQyxlQUFPLFdBREw7QUFFRkQsY0FBTSxJQUZKO0FBR0ZFLGdCQUFRO0FBSE4sS0FEd0I7QUFNOUJDLGFBQVMsRUFOcUI7QUFPOUJDLGtCQUFjLENBUGdCO0FBUTlCQyxhQUFTLElBUnFCO0FBUzlCQyxXQUFPLEVBVHVCO0FBVTlCQyxZQUFRLEVBVnNCO0FBVzlCQyxXQUFPO0FBWHVCLENBQWxDOztBQWNBbEMsWUFBWVQsT0FBTzRDLFdBQVAsQ0FBbUJsQyxZQUFuQixFQUFpQyxLQUFqQyxDQUFaOztBQUVBTixJQUFJeUMsb0JBQUo7QUFDQXpDLElBQUkwQyxNQUFKLENBQVdDLElBQVgsQ0FBZ0IvQyxPQUFPZ0QsTUFBUCxDQUFjdkMsU0FBZCxFQUF5QndDLE1BQXpDIiwiZmlsZSI6Im9zYy1yZWNvcmQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBtZW13YXRjaCA9IHJlcXVpcmUoJ21lbXdhdGNoLW5leHQnKSxcbiAgICBjbCA9IHJlcXVpcmUoJy4uL3NyYy9pbmRleCcpLmRlZmF1bHQsXG4gICAgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKSxcbiAgICBsbWRiSW4gPSBuZXcgY2wubm9kZXMuc3RvcmFnZS5MTURCTm9kZSgpLFxuICAgIG9zYyA9IG5ldyBjbC5ub2Rlcy5pby5PU0NOb2RlKDUyNzc3KSxcbiAgICBkYXRhUGF0aCA9IHBhdGgucmVzb2x2ZSgnLi4vZGF0YS9sbWRiL29zYy1yZWNvcmQtdGVzdCcpO1xuXG5sZXQgaW5wdXRVdWlkLCBEYXRhQ2hhbm5lbHMgPSB7fTtcblxubWVtd2F0Y2gub24oJ2xlYWsnLCBmdW5jdGlvbihpbmZvKSB7XG4gICAgY29uc29sZS5sb2coYFdBUk5JTkc6ICR7aW5mby5yZWFzb259IC0gR3Jvd3RoOiAke2luZm8uZ3Jvd3RofWApO1xufSk7XG5cbmxtZGJJbi5jcmVhdGVEYXRhU2V0KGRhdGFQYXRoLCAyLjAsICdvc2MtcmVjb3JkLXRlc3QnKTtcblxubG1kYkluLm9uKCdzdGF0cycsIChzdGF0cykgPT4ge1xuICAgIGlmIChzdGF0cy5kYXRhLmluICYmIHN0YXRzLmRhdGEuaW4uRGF0YUV2ZW50ID49IDEwMDApIHtcbiAgICAgICAgb3NjLmRpc2FibGUoKTtcbiAgICB9XG59KTtcblxubG1kYkluLm9uKCdkb25lJywgKCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdkb25lIScpO1xuICAgIHByb2Nlc3MuZXhpdCgwKTtcbn0pO1xuXG5sbWRiSW4ub24oJ2Vycm9yJywgKGVycikgPT4ge1xuICAgIGNvbnNvbGUubG9nKGVyci5tZXNzYWdlKTtcbiAgICBwcm9jZXNzLmV4aXQoZXJyLmNvZGUpO1xufSk7XG5cbm9zYy5vbignYWRkY2hhbm5lbCcsIChjaGFubmVsKSA9PiB7XG4gICAgbG1kYkluLm1ldGEuRGF0YVNldC5EYXRhQ2hhbm5lbHNbY2hhbm5lbC51dWlkXSA9XG4gICAgICAgIE9iamVjdC5hc3NpZ24oe30sbG1kYkluLm1ldGEuRGF0YVNldC5EYXRhQ2hhbm5lbHNbJ29zYy1yZWNvcmQtdGVzdCddKTtcbiAgICBsbWRiSW4ubWV0YS5EYXRhU2V0LkRhdGFDaGFubmVsc1tjaGFubmVsLnV1aWRdLnRpdGxlID0gY2hhbm5lbC50aXRsZTtcbn0pO1xuXG5EYXRhQ2hhbm5lbHNbJ29zYy1yZWNvcmQtdGVzdCddID0ge1xuICAgIHR5cGU6IHtcbiAgICAgICAgY2xhc3M6ICdEYXRhRXZlbnQnLFxuICAgICAgICB0eXBlOiBudWxsLFxuICAgICAgICBsZW5ndGg6IDBcbiAgICB9LFxuICAgIGtleVNpemU6IDE2LFxuICAgIGtleVByZWNpc2lvbjogNixcbiAgICBrZXlVbml0OiBudWxsLFxuICAgIHVuaXRzOiBbXSxcbiAgICBsYWJlbHM6IFtdLFxuICAgIHV1aWRzOiBbXVxufTtcblxuaW5wdXRVdWlkID0gbG1kYkluLmNyZWF0ZUlucHV0KERhdGFDaGFubmVscywgZmFsc2UpO1xuXG5vc2MuZW5hYmxlTWVzc2FnZVJlY2VpdmUoKTtcbm9zYy5vdXRwdXQucGlwZShsbWRiSW4uaW5wdXRzW2lucHV0VXVpZF0uc3RyZWFtKTtcbiJdfQ==